var syncURL;onmessage=function(a){var b=a.data;syncURL=b.syncURL;var c='diff'!==b.method,d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){for(;!c;){for(var e=new Date().getTime()+3e3;new Date().getTime()<e;);hasProcessed(b.token,decodeURIComponent(b.url.split('/').pop().split('npx')[0]+'npx'),function(f){c=f})}postMessage({req:'done'})}else console.log(d.responseText)},d.open('PUT',b.url,!0),d.setRequestHeader('Content-Type','text/plain'),d.send(b.data)};function hasProcessed(a,b,c){apiPostSync('getSyncStatus.php',{token:a,filename:b},function(d,e){if(200===e){var d=JSON.parse(d);1==d.syncProcessed?c(!0):c(!1)}else console.log(d),c(!1)})}function apiPostSync(a,b,c){a=syncURL+a;var d='';for(var e in b)0<d.length&&(d+='&'),d+=e+'='+encodeURIComponent(b[e]);var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&c(f.responseText,f.status)},f.open('POST',a,!1),f.setRequestHeader('Content-type','application/x-www-form-urlencoded'),f.send(d)}