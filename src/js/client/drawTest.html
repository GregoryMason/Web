<html>
<head>
	<script src="js/libs/jquery-3.1.1.min.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function(event) {
			var ctx = $('#drawing-viewer')[0].getContext("2d");
			ctx.strokeStyle = "#000000";
			var ongoingTouches = new Array();
			$('#drawing-viewer')[0].onpointerdown = function(event) {
				if (true) {
					ongoingTouches.push(copyTouch(event));
					ctx.beginPath();

				}
			}
			$('#drawing-viewer')[0].onpointermove = function(event) {
				if (event.pressure > 0) {
					if (event.buttons === 32) {
						ctx.clearRect(event.clientX - 10, event.clientY - 10, 20, 20)
					}
					else {
						var idx = ongoingTouchIndexById(event.pointerId);

						ctx.beginPath();
						ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
						ctx.lineTo(event.clientX, event.clientY);
						ctx.lineWidth = event.pressure*10;
						ctx.stroke();

						ongoingTouches.splice(idx, 1, copyTouch(event));
					}
				}
			}
			$('#drawing-viewer')[0].onpointerup = function(event) {
				var idx = ongoingTouchIndexById(event.pointerId);
				if (idx >= 0 && event.buttons !== 32) {
					ctx.lineWidth = event.pressure*10;
					ctx.fillStyle = "#000000";
					ctx.beginPath();
					ctx.moveTo(ongoingTouches[idx].pageX, ongoingTouches[idx].pageY);
					ctx.lineTo(event.clientX, event.clientY);

					ongoingTouches.splice(idx, 1);
				}
			}
			$('#drawing-viewer')[0].onpointercancel = function(event) {
				var idx = ongoingTouchIndexById(evt.pointerId);
				ongoingTouches.splice(idx, 1);
			}
			function copyTouch(touch) {
				return { identifier: touch.pointerId, pageX: touch.clientX, pageY: touch.clientY };
			}
			function ongoingTouchIndexById(idToFind) {
				for (var i = 0; i < ongoingTouches.length; i++) {
					var id = ongoingTouches[i].identifier;
					
					if (id == idToFind) {
						return i;
					}
				}
				return -1;
			}
		});
	</script>
</head>
<body>
	<canvas id="drawing-viewer" width="600" height="600" style="border:solid black 1px; touch-action:none"></canvas>
</body>
</html>