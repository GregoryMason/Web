const S3UrlMin=function(a, b, c){this.request=a,this.protocol=b,this.syncUrl=c,this.url="",this.filename="",this.diffIndexes=void 0,this.expireTime=new Date(0)};S3UrlMin.prototype.getUrl=function(a, b, c, d){const e=this.filename!==b||this.diffIndexes!==void 0&&this.diffIndexes!==d;if(!e&&0<this.url.length&&this.expireTime>new Date)c(this.url,200);else{const f={token:a,filename:b,index:"0",md5:"m"};switch(d&&(f.multidex=d),this.protocol){case"GET":this.reqGet(this.syncUrl+this.request+".php?token={0}&filename={1}&r={2}".format(a,b,new Date().getTime()),(g, h)=>{this.updateDate(),this.url=g,200!=h&&(this.url=""),c(this.url,h),e&&(this.filename=b,this.diffIndexes=d)});break;case"POST":this.apiPost(this.request+".php",f,(g, h)=>{this.updateDate(),this.url=g,200!=h&&(this.url=""),c(this.url,h),e&&(this.filename=b,this.diffIndexes=d)});}}},S3UrlMin.prototype.getUrlSync=function(a, b, c, d){const e=this.filename!==b||void 0!==this.diffIndexes&&this.diffIndexes!==d;if(e&&(this.filename=b,this.diffIndexes=d),!e&&0<this.url.length&&this.expireTime>new Date)c(this.url,200);else{const f={token:a,filename:b,index:"0",md5:"m"};switch(void 0!==d&&null!==d&&(f.multidex=d),this.protocol){case"GET":this.reqGetSync(this.syncUrl+this.request+".php?token={0}&filename={1}&r={2}".format(a,b,new Date().getTime()),(g, h)=>{this.updateDate(),this.url=g,200!=h&&(this.url=""),c(this.url,h),e&&(this.filename=b,this.diffIndexes=d)});break;case"POST":this.apiPostSync(this.request+".php",f,(g, h)=>{this.updateDate(),this.url=g,200!=h&&(this.url=""),c(this.url,h),e&&(this.filename=b,this.diffIndexes=d)});}}},S3UrlMin.prototype.updateDate=function(){this.expireTime=new Date,this.expireTime.setMinutes(this.expireTime.getMinutes()+15)},S3UrlMin.prototype.apiPost=function(a, b, c){a=this.syncUrl+a;let d="";for(const f in b)0<d.length&&(d+="&"),d+=f+"="+encodeURIComponent(b[f]);const e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&c(e.responseText,e.status)},e.open("POST",a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(d)},S3UrlMin.prototype.apiPostSync=function(a, b, c){a=this.syncUrl+a;let d="";for(const f in b)0<d.length&&(d+="&"),d+=f+"="+encodeURIComponent(b[f]);const e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&c(e.responseText,e.status)},e.open("POST",a,!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(d)},S3UrlMin.prototype.reqGet=function(a, b){const c=new XMLHttpRequest;c.addEventListener("progress",function(d){progress(d,"Download")}),c.onreadystatechange=function(){4==c.readyState&&b(c.responseText,c.status)},c.open("GET",a,!0),c.send()},S3UrlMin.prototype.reqGetSync=function(a, b){const c=new XMLHttpRequest;c.addEventListener("progress",function(d){progress(d,"Download")}),c.onreadystatechange=function(){4==c.readyState&&b(c.responseText,c.status)},c.open("GET",a,!1),c.send()};